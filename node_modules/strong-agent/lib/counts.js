var nf;

var Timer = require('./timer');
var stats = require('./node-measured').createCollection('callCounts');

exports.init = function() {
	nf = global.nodefly;
	start();
};

exports.sample = function(code) {
	var meter = stats.meter(code);
	meter.mark();
	meter.unref();
};

function start() {
	Timer.repeat(60 * 1000, function () {
		var data = stats.toJSON();
		data._ts = nf.millis();
		nf.emit('callCounts', data);
		stats.reset();
	});
}
